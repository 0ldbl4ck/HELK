# HELK logon-ids-conversions filter conf
# HELK build Stage: Alpha
# Author: Nate Guagenti (@neu5ron)
# License: GPL-3.0

filter {
  if [event_id] and [SubjectLogonId] =~ /^0x/ {
    ruby {
      code => '
        subject_logon_id = event.get("SubjectLogonId")
        subject_logon_id = subject_logon_id.gsub(/^0x/, "")
        event.set("SubjectLogonId", subject_logon_id.to_s.hex)
      '
      tag_on_exception =>  "_rubyexception_SubjectLogonId_hex_to_decimal"
      add_field => { "z_logstash_pipeline" => "SubjectLogonId_hex_to_decimal" }
    }
  }
  if [event_id] and [TargetLogonId] =~ /^0x/ {
    ruby {
      code => '
        target_logon_id = event.get("TargetLogonId")
        target_logon_id = target_logon_id.gsub(/^0x/, "")
        event.set("TargetLogonId", target_logon_id.to_s.hex)
      '
      tag_on_exception =>  "_rubyexception_TargetLogonId_hex_to_decimal"
      add_field => { "z_logstash_pipeline" => "TargetLogonId_hex_to_decimal" }
    }
  }
}
